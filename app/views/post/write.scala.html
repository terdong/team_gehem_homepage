@(form: Form[_], board_seq: Long, file_form:Form[_])(implicit messages: Messages, header: controllers.traits.Header)
@implicitFC = @{
    b3.horizontal.fieldConstructor("col-md-1", "col-md-11")
}

@scripts = {
    <script src="@routes.Assets.versioned("javascripts/tinymce/tinymce.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/tinymce_init.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/post_submit.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/bootstrap-notify.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/clipboard.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("fine-uploader/jquery.fine-uploader.js")" type="text/javascript"></script>
    <script type="text/javascript">
            function hash_button_click(file_name) {
                var message = file_name + "파일의 url을 클립보드(ctrl+c)에 저장했습니다.";
                $.notify({
                    message: message
                },{
                    // settings
                    type: 'info',
                    placement: {
                        from: "bottom",
                        align: "center"
                    },
                    delay: 1500
                });
            }

            $(document).ready(function () {
                var clipboard = new Clipboard('.qq-uuid');

                $('#fine-uploader-gallery').fineUploader({
                    template: 'qq-template-gallery',
                    request: {
                        endpoint: '/upload/file'
                    },
                    thumbnails: {
                        placeholders: {
                            waitingPath: '/assets/fine-uploader/placeholders/waiting-generic.png',
                            notAvailablePath: '/assets/fine-uploader/placeholders/not_available-generic.png'
                        }
                    },
                    validation: {
                        allowedExtensions: ['jpeg', 'jpg', 'gif', 'png', 'mp3', 'flac', 'ogg', 'avi', 'mp4', 'zip', '7z', 'xls', 'doc', 'sh', 'txt', 'rar']
                    },
                    deleteFile: {
                        enabled: true,
                        method: "POST",
                        endpoint: "/upload/file/delete"
                    },
                    autoUpload: true,
                    callbacks: {
                        onComplete: function(id, name, responseJSON, maybeXhr) {
                            //console.log(JSON.stringify(responseJSON));
                            var form = $('form[id=postForm]');
                            $("<input></input>").attr({
                                type: "hidden",
                                id: id,
                                name: "upload_files[]",
                                value: JSON.stringify(responseJSON['file_info'])
                            }).appendTo(form);

                            // 추가된 파일은 임시디렉토리에 있기 때문에 url을 지정할 수 없음.
/*                            var content_type = responseJSON['file_info']['content_type'];
                            if(content_type.split("/")[0] == "image"){
                                var uuid_span = $('.qq-uuid').eq(id);
                                uuid_span.val(name);
                                uuid_span.attr("data-clipboard-text", "/images/" + responseJSON['newUuid']);
                                uuid_span.removeClass("qq-hide");
                            }*/
                        },
                        onDelete: function(id) {
                            $('input[name="upload_files[]"]').remove("#" + id);
                        }
                    }
                });
            });
    </script>
    @includes.qq_template_gallery()
}
@styles = {
    <link href="@routes.Assets.versioned("fine-uploader/fine-uploader-gallery.css")" media="all" rel="stylesheet" type="text/css" />
    <link href="@routes.Assets.versioned("stylesheets/animate.css")" media="all" rel="stylesheet" type="text/css" />
}

@main("write", "board", scripts, styles) {
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">@{
                header.board_list.map(list => {
                    list.find(p => p.seq == board_seq).head.name
                })
            }</h3>
        </div>
        <div class="panel-body">

        @b3.form(routes.PostController.writePost(board_seq), 'id -> "postForm") {
            @b3.hidden("board_seq", board_seq)
            @b3.text(form("subject"), '_label -> "Subject")
            @b3.textarea(form("content"), '_label -> "Content", 'rows -> 5)
            @b3.button('class -> "btn btn-default pull-right"){<span class="glyphicon glyphicon-ok"></span> Write}

            @b3.submit('class -> "btn btn-default", 'style ->"display:none;"){Write}
        }
        </div>
        <ul class="list-group">
            <li class="list-group-item">
                <div class="row">
                    <label class="control-label col-md-1" for="content">File Upload</label>
                    <div class="col-md-11">
                        <div id="fine-uploader-gallery"/>
                    </div>
                </div>
            </li>
        </ul>
    </div>

@*    @tags.tag_post_write_form(writeForm, board_seq, routes.PostController.writePost(board_seq)) *@
}
